# MemMang
* 重新设计存储管理方案：使用改进的TLSF算法做到时间复杂度O(1)。
* 独立的测试程序在Test中，使用随机生成的大小进行测试。  
[代码](heap_6.c)


## 算法
* TLSF算法采用二级结构，由于本算法针对的内存太小，二级结构开销过大，因此只采取一级结构，相当于SLI=1。
* 块头以及数组结构均沿用原TLSF算法结构.

### malloc策略
    1、对size进行操作，使size符合可分配条件。  
    2、通过log运算找到请求大小对应的FLI数组编号，log运算可以通过位运算实现。  
    3、通过上一步得出的编号经过位运算得到大于等于size的块地址。  
    4、分块，将未使用块放回FLI数组，将使用块返回。  

### free策略
    1、验证目标块是已经使用的。  
    2、检查目标块的物理上的前一块是否为未使用的，若是则合并。  
    3、检验目标块的物理上的后一块是否为未使用的，若是则合并。  
    4、改变该块的块头，重新加入FLI数组。  
### 一些细节
#### 关于位运算
malloc中的两次位运算都相当于求一个二进制数最高位的1在第几位，可以用如下位运算实现。
```
int16_t LOG2(uint16_t _val)
{
	int re;
	__asm bsr EAX, _val;
	__asm mov re, EAX;
	return (int16_t)re;
}
```
以上代码是针对win32的，实际应用时需要进行适当的修改。
#### 关于块之间的关系
对于已分配的块，块头只记录size以及物理上的前一块；对于未分配的块，块头记录size、逻辑上的前一块和后一块、物理上的前一块。  
为了维护未分配块，在不改变块大小时只需要维护一组双向链表；在改变块大小时要对该块的物理上的后一块进行修改。获取物理上的后一块的方法为块地址加上size。
